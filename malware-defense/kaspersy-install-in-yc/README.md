# Развертывание Kaspersky Antivirus в Yandex.Cloud
Цель демо: Развернуть решение Kaspersky security Center и удаленно установить агенты защиты в Yandex.Cloud для обеспечения антивирусной защиты виртуальных машин и контейнеров в COI (Container Optimised Image) //возможно добавить про K8s. 

## Схема:
![Kaspersky](https://user-images.githubusercontent.com/85429798/124883024-9a9fe700-dfd9-11eb-82d6-1f795b4ee383.jpg) 


## Описание:
В рамках workshop будут выполнены:
- установка инфраструктуры с помощью terraform (infrastructure as a code)
- инсталяция, базовая конфигурация и ряд тестов [Kaspersky Security для виртуальных и облачных сред (PAYG)](https://cloud.yandex.ru/marketplace/products/f2eghdh3f8nnbu389nsh) 


Установка инфраструктуры с помощью terraform:
- создание ВМ lin, win, containter optimized image
- создание ВМ Kaspersky Security Center
- предсоздание УЗ на ВМ для удаленной установки kaspersky endpoint security
- скачивание на lin машины тестовый вирус eicar


Инсталяция, базовая конфигурация и ряд тестов [Kaspersky Security для виртуальных и облачных сред (PAYG)](https://cloud.yandex.ru/marketplace/products/f2eghdh3f8nnbu389nsh):
- подключение к KSC по rdp
- удаленная установка агентов на lin, win машины
- запуск сканирования на вирусы
- запуск проверки container security на ВМ container optimized image


## Подготовка/Пререквизиты:
- установить и настроить [yc client](https://cloud.yandex.ru/docs/cli/quickstart)
- установить [terraform](https://www.terraform.io/downloads.html)
- скачать архив с файлами "kaspersy-install-in-yc.zip"
- вставьте необходимые параметры в файле variables.tf (token, cloud_id, folder_id)

Системные требования для целевых ВМ:
В рамках workshop используется Kaspersky Endpoint Security 11.2.0 для Linux
[системные требования](https://support.kaspersky.com/KES4Linux/11.2.0/ru-RU/206762.htm)


## Развертывание:
- перейти в папку со скаченными файлами
- выполнить команды:
```
terraform init
terraform apply 
```

## Описание шагов работы с Kaspersky:
1) Подождите 3 мин
2) Подключитесь к KSC по rdp на внешний адрес
адрес - будет показан в output в командной строке
```
логин: Administrator
пароль: !QAZ2wsx
```
2) Скачиваем KES 11.2 ///
https://www.kaspersky.ru/small-to-medium-business-security/downloads/endpoint?icid=ru_sup-site_trd_ona_oth__onl_b2b_klsupport_tri-dl____kes___&_ga=2.153833968.955193927.1626337397-1534905402.1618923524 

3) Создаем инсталяционный пакет для KES 11.2

3) Добавляем IP диапозон необходимых ВМ в "Опрос сети"



3) Создать задачу на установку антивирусного агента linux 
-указать ssh credentials , выбрать пакет 11.2 и агент 12

4) Создать задачу на установку антивирусного агента Windows
-указать windows credentials



